---
title: "Project 1 Goup E XML"
author: "Phillip Rodriguez-Lebron & Adam Weimerskirch"
date: "6/8/2019"
output:
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, message = FALSE, warning = FALSE}

library(xml2)
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(DT)
library(GGally)

```

# XML

## What does XML stand for?

XML stands for extensible markup language?

## What is XML data?

Essentially XML data is a document that stores data in what is known as an XML tree structure. The tree structure consists of an element called a root element, child elements, and sub-child elements. These terms are used to describe the structure and the relationship between the elements. The root element contains the child elements, and the child elements contain the sub-child elements. All XML documents must contain one root element that acts as the parent of all of the elements. 

Example: 


```{r exampleXML, echo=TRUE, eval=FALSE}
<theater>
  <movie category = "Crime">
    <title>Goodfellas</title>
    <director><Martin Scorsese</director>
    <date>1990</date>
  </movie>
  <movie category = "Horror">
    <title>Halloween</title>
    <director>John Carpenter</director>
    <date>1978</date>
  </movie>
</theater>

```

In this example `<theater>` is the root element, `<movie>` is the child element, and `<title>`, `<director>`, and `<date>` are the sub-child elements. As you can see all elements are enclosed in `<>` brackets and must be ended with a forward slash `</>` within the bracket to close the element.  

## Where does XML get used?

XML is used in a wide variety of IT systems including but not limited to computers, software, and programming languages. It is often used in the distribution of data over the internet.  

## Why is it a good way to store data?

There are many reasons why XML is a good way to store data. First of all XML is readable by humans and machines which makes it highly functional. Secondly, XML stores all of the information about the data that may be of use to the one receiving it. And although there are pre-set element names, the user has the freedom to assign user defined names which makes it very customizable.  

# Packages

The main package that was used to work with the XML data was `xml2`. The two functions within `xml2` that were essential in parsing through the data were `xml_find_all` and `xml_text`. The function `xml_find_all` was used to make a list of the nodesets. The function `xml_text` was used to isolate the text within the list of the noedsets. These functions made it possible to parse through the elements of the data.  

# Data

## Source

The XML file was from [GGobi.org](http://www.ggobi.org/book/). From the introduction on its website GGobi "is an open source visualization program for exploring high-dimensional data". The XML file was taken from the data section on the GGobi text book page.  

The original source of the dataset is:

Campbell, N. A. & Mahon, R. J. (1974), A Multivariate Study of Variation in Two Species of Rock Crab of genus Leptograpsus, Australian Journal of Zoology 22, 417â€“425.

## Description

The data consists of measurements of rock crabs that were collected in Freemantle, Australia. Each rock crab was adminitered five measurements, and the species and color of each were noted.

## Variables

The dataset contains eight variables and 200 observations. The variables are species (orange/blue), sex (male/female),  index (observations 1-200), frontal lip length, rear width, carapace length, carapace width, and body depth. All measurements are in millimeters.


# Crab Measurement Data

## Data Table

```{r dataset table}

xml <- read_xml("http://www.ggobi.org/book/data/australian-crabs.xml")

records <- xml_find_all(xml, "//record")

text <- xml_text(records)
text <- str_remove_all(text, "[\n]")
text <- text[-c(201:208)]


getTable <- function(x){

  split <- strsplit(x[1:200], " ")
  
  split.df <- data.frame(matrix(unlist(split), nrow = length(split), byrow = TRUE),                   stringsAsFactors = FALSE)
  
  split.tbl <- tbl_df(split.df)
  
  a <- split.tbl %>% rename(Species = X1, Sex = X2, Index = X3, "Frontal Lip" = X4,
                     "Rear Width" = X5, "Carapace Length" = X6, "Carapace Width" = X7,                       "Body Depth" = X8) %>% mutate(Species = as.factor(Species), 
                     Sex = as.factor(Sex)) %>% mutate_if(is.character, as.numeric) %>%
                     mutate(Species = recode(Species, "0" = "Blue",  "1" = "Orange")) %>%  mutate(Sex = recode(Sex, "0" = "Male", "1" = "Female"))
  
  return(a)

}

crab.table <- getTable(text)

datatable(crab.table)

```

```{r sizeGroups}

sizeGroups <- function(x){
  if(!is.vector(x)){
    stop("Please provide vector to classify into groups")
  }
  
  small <- quantile(x, 0.25)
  large <- quantile(x, 0.75)
  
  ifelse(x < small, "Small", ifelse((x >= small) & (x <= large), "Medium", "Large"))
}

crab.table <- crab.table %>%
  mutate(FLGroup = sizeGroups(crab.table$`Frontal Lip`),
         RWGroup = sizeGroups(crab.table$`Rear Width`),
         CLGroup = sizeGroups(crab.table$`Carapace Length`),
         CWGroup = sizeGroups(crab.table$`Carapace Width`),
         BDGroup = sizeGroups(crab.table$`Body Depth`))
```

## Contingency Tables

```{r contingency table}

table(crab.table$Sex, crab.table$Species) %>% kable(caption = "Sex and Species of Crabs") %>% kable_styling()

table(crab.table$Sex, crab.table$BDGroup) %>% kable(caption = "The Body Depth of Crabs by Sex") %>% kable_styling()

table(crab.table$Species, crab.table$BDGroup) %>% kable(caption = "The Body Depth of Crabs by Species") %>% kable_styling()

table(crab.table$RWGroup, crab.table$FLGroup) %>% kable(caption = "The Frontal Lip of Crabs by Rear Width") %>% kable_styling()

```

## Plots

### One Variable Plots

The barplots below are visual depictions of the first two contingency tables.

```{r bar}
g <- ggplot(crab.table)

#barplot
g + geom_bar(aes(x = Species, fill = Sex))
g + geom_bar(aes(x = Sex, fill = BDGroup))
```

The boxplot below shows that the Orange species is has a larger body depth than the the Blue species, for both males and females. 

```{r box}
g <- ggplot(crab.table)

#boxplot
g + geom_boxplot(aes(y = `Body Depth`, fill = Sex)) + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) + facet_grid( ~ Species)
```

### Two Variable Plots

The scatterplot below shows that carapace width and length have a strong positive correlation, regardless of sex or species.

```{r scatter}
g <- ggplot(crab.table)

#scatterplot
g + geom_point(aes(x = `Carapace Width`, y = `Carapace Length`)) + 
  facet_grid(Sex ~ Species)
```

The pairs plot below shows that each the size measurements for the crabs are positively correlated with the others.  That is, as one dimension of the crab grows, each other dimension tends to grow as well.

```{r pairs, message = FALSE}
#scatterplot pairs
ggpairs(crab.table, columns = 4:8)

```

From these plots, it appears that the width variables have a bimodal distribution as the crabs increase in size.  It seems likely that a categorical variable (possibly species or sex) plays a role in this relationship.  It would be interesting to do some linear modelling with this dataset to see which variables are most predictive those width variables.

```{r density}
g <- ggplot(crab.table)

#densities of width variables
g + geom_density(aes(x = `Rear Width`)) +
  facet_grid(Sex ~ Species)
```